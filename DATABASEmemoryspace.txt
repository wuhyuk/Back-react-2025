DROP DATABASE IF EXISTS memoryspace;
CREATE DATABASE memoryspace CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
USE memoryspace;



CREATE TABLE users (
  id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  username VARCHAR(50) NOT NULL UNIQUE,
  passwordHash VARCHAR(255) NOT NULL,
  nickname VARCHAR(50) NOT NULL,
  email VARCHAR(255) NOT NULL UNIQUE,
  liveIn VARCHAR(100),
  PRIMARY KEY (id)
);

CREATE TABLE stars (
  id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  userId BIGINT UNSIGNED NOT NULL,
  name VARCHAR(100) NOT NULL,
  
  PRIMARY KEY (id),
  INDEX (userId),
  FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE planets (
  id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  starId BIGINT UNSIGNED NOT NULL,
  
  name VARCHAR(100),
  isDeleted TINYINT(1) DEFAULT 0,
  
  PRIMARY KEY (id),
  INDEX (starId),
  FOREIGN KEY (starId) REFERENCES stars(id) ON DELETE CASCADE
);

CREATE TABLE planet_media (
  id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  planetId BIGINT UNSIGNED NOT NULL,
  
  mediaType ENUM('photo','video') NOT NULL,
  filePath VARCHAR(500) NOT NULL,
  mimeType VARCHAR(100),
  sizeBytes BIGINT UNSIGNED DEFAULT 0,
  
  PRIMARY KEY (id),
  INDEX (planetId),
  FOREIGN KEY (planetId) REFERENCES planets(id) ON DELETE CASCADE
);

CREATE TABLE tags (
  id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  name VARCHAR(100) NOT NULL UNIQUE,
  PRIMARY KEY (id)
);

CREATE TABLE planet_tags (
  planetId BIGINT UNSIGNED NOT NULL,
  tagId BIGINT UNSIGNED NOT NULL,
  
  PRIMARY KEY (planetId, tagId),
  
  FOREIGN KEY (planetId) REFERENCES planets(id) ON DELETE CASCADE,
  FOREIGN KEY (tagId) REFERENCES tags(id) ON DELETE CASCADE
);

CREATE TABLE reports (
  id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  planetId BIGINT UNSIGNED NOT NULL,
  reporterUserId BIGINT UNSIGNED,
  
  reason VARCHAR(255),
  status ENUM('new','processed') DEFAULT 'new',
  
  PRIMARY KEY (id),
  
  FOREIGN KEY (planetId) REFERENCES planets(id) ON DELETE CASCADE,
  FOREIGN KEY (reporterUserId) REFERENCES users(id) ON DELETE SET NULL
);