-- ì§€ë„ í…ŒìŠ¤íŠ¸ìš© ìƒ˜í”Œ ë°ì´í„° ì‚½ì… (test ê³„ì • ê¸°ì¤€)

USE memoryspace;

-- 1. test ì‚¬ìš©ì ID ê°€ì ¸ì˜¤ê¸°
SET @userId = (SELECT id FROM users WHERE username = 'test');

-- 2. test ì‚¬ìš©ìì˜ Star ìƒì„±
INSERT INTO stars (userId, name)
VALUES (@userId, '2024 ì—¬í–‰ ì¶”ì–µ');

SET @starId = LAST_INSERT_ID();

-- 3. test ì‚¬ìš©ìì˜ Planet ìƒì„±
INSERT INTO planets (starId, name, isDeleted)
VALUES (@starId, 'í•œêµ­ ì—¬í–‰', 0);

SET @planetId = LAST_INSERT_ID();

-- 4. ìœ„ì¹˜ ì •ë³´ê°€ ìˆëŠ” ë¯¸ë””ì–´ 10ê°œ ì‚½ì… (ê°ê¸° ë‹¤ë¥¸ ìœ„ì¹˜)
INSERT INTO planet_media (planetId, mediaType, filePath, mimeType, sizeBytes, location, latitude, longitude)
VALUES 
  -- ì„œìš¸ (3ê°œ)
  (@planetId, 'photo', '/upload/seoul1.jpg', 'image/jpeg', 1024000, 'ì„œìš¸', 37.5665, 126.9780),
  (@planetId, 'photo', '/upload/seoul2.jpg', 'image/jpeg', 2048000, 'ì„œìš¸', 37.5665, 126.9780),
  (@planetId, 'video', '/upload/seoul_video.mp4', 'video/mp4', 5120000, 'ì„œìš¸', 37.5665, 126.9780),
  
  -- ë¶€ì‚° (2ê°œ)
  (@planetId, 'photo', '/upload/busan1.jpg', 'image/jpeg', 1536000, 'ë¶€ì‚°', 35.1796, 129.0756),
  (@planetId, 'photo', '/upload/busan2.jpg', 'image/jpeg', 1792000, 'ë¶€ì‚°', 35.1796, 129.0756),
  
  -- ì œì£¼ë„ (2ê°œ)
  (@planetId, 'photo', '/upload/jeju1.jpg', 'image/jpeg', 2560000, 'ì œì£¼ë„', 33.4996, 126.5312),
  (@planetId, 'video', '/upload/jeju_video.mp4', 'video/mp4', 8192000, 'ì œì£¼ë„', 33.4996, 126.5312),
  
  -- ê°•ë¦‰ (1ê°œ)
  (@planetId, 'photo', '/upload/gangneung.jpg', 'image/jpeg', 1280000, 'ê°•ë¦‰', 37.7519, 128.8761),
  
  -- ê²½ì£¼ (1ê°œ)
  (@planetId, 'photo', '/upload/gyeongju.jpg', 'image/jpeg', 1408000, 'ê²½ì£¼', 35.8562, 129.2247),
  
  -- ì „ì£¼ (1ê°œ)
  (@planetId, 'photo', '/upload/jeonju.jpg', 'image/jpeg', 1664000, 'ì „ì£¼', 35.8242, 127.1479);
  
  -- 4. ì „ ì„¸ê³„ ë‹¤ì–‘í•œ ìœ„ì¹˜ì˜ ë¯¸ë””ì–´ 20ê°œ ì‚½ì…
INSERT INTO planet_media (planetId, mediaType, filePath, mimeType, sizeBytes, location, latitude, longitude)
VALUES 
  -- ğŸ‡°ğŸ‡· í•œêµ­ - ì„œìš¸ (2ê°œ)
  (@planetId, 'photo', '/upload/seoul1.jpg', 'image/jpeg', 1024000, 'ì„œìš¸', 37.5665, 126.9780),
  (@planetId, 'video', '/upload/seoul_video.mp4', 'video/mp4', 5120000, 'ì„œìš¸', 37.5665, 126.9780),
  
  -- ğŸ‡¯ğŸ‡µ ì¼ë³¸ - ë„ì¿„ (2ê°œ)
  (@planetId, 'photo', '/upload/tokyo1.jpg', 'image/jpeg', 1536000, 'ë„ì¿„', 35.6762, 139.6503),
  (@planetId, 'photo', '/upload/tokyo2.jpg', 'image/jpeg', 1792000, 'ë„ì¿„', 35.6762, 139.6503),
  
  -- ğŸ‡¨ğŸ‡³ ì¤‘êµ­ - ë² ì´ì§• (1ê°œ)
  (@planetId, 'photo', '/upload/beijing.jpg', 'image/jpeg', 2048000, 'ë² ì´ì§•', 39.9042, 116.4074),
  
  -- ğŸ‡¹ğŸ‡­ íƒœêµ­ - ë°©ì½• (2ê°œ)
  (@planetId, 'photo', '/upload/bangkok1.jpg', 'image/jpeg', 1280000, 'ë°©ì½•', 13.7563, 100.5018),
  (@planetId, 'video', '/upload/bangkok_video.mp4', 'video/mp4', 6144000, 'ë°©ì½•', 13.7563, 100.5018),
  
  -- ğŸ‡«ğŸ‡· í”„ë‘ìŠ¤ - íŒŒë¦¬ (3ê°œ)
  (@planetId, 'photo', '/upload/paris1.jpg', 'image/jpeg', 2560000, 'íŒŒë¦¬', 48.8566, 2.3522),
  (@planetId, 'photo', '/upload/paris2.jpg', 'image/jpeg', 2304000, 'íŒŒë¦¬', 48.8566, 2.3522),
  (@planetId, 'video', '/upload/paris_video.mp4', 'video/mp4', 7168000, 'íŒŒë¦¬', 48.8566, 2.3522),
  
  -- ğŸ‡¬ğŸ‡§ ì˜êµ­ - ëŸ°ë˜ (2ê°œ)
  (@planetId, 'photo', '/upload/london1.jpg', 'image/jpeg', 1920000, 'ëŸ°ë˜', 51.5074, -0.1278),
  (@planetId, 'photo', '/upload/london2.jpg', 'image/jpeg', 1664000, 'ëŸ°ë˜', 51.5074, -0.1278),
  
  -- ğŸ‡ºğŸ‡¸ ë¯¸êµ­ - ë‰´ìš• (3ê°œ)
  (@planetId, 'photo', '/upload/newyork1.jpg', 'image/jpeg', 2816000, 'ë‰´ìš•', 40.7128, -74.0060),
  (@planetId, 'photo', '/upload/newyork2.jpg', 'image/jpeg', 2432000, 'ë‰´ìš•', 40.7128, -74.0060),
  (@planetId, 'video', '/upload/newyork_video.mp4', 'video/mp4', 8192000, 'ë‰´ìš•', 40.7128, -74.0060),
  
  -- ğŸ‡¦ğŸ‡º í˜¸ì£¼ - ì‹œë“œë‹ˆ (2ê°œ)
  (@planetId, 'photo', '/upload/sydney1.jpg', 'image/jpeg', 2176000, 'ì‹œë“œë‹ˆ', -33.8688, 151.2093),
  (@planetId, 'video', '/upload/sydney_video.mp4', 'video/mp4', 5632000, 'ì‹œë“œë‹ˆ', -33.8688, 151.2093),
  
  -- ğŸ‡§ğŸ‡· ë¸Œë¼ì§ˆ - ë¦¬ìš°ë°ìë„¤ì´ë£¨ (1ê°œ)
  (@planetId, 'photo', '/upload/rio.jpg', 'image/jpeg', 1856000, 'ë¦¬ìš°ë°ìë„¤ì´ë£¨', -22.9068, -43.1729),
  
  -- ğŸ‡ªğŸ‡¬ ì´ì§‘íŠ¸ - ì¹´ì´ë¡œ (1ê°œ)
  (@planetId, 'photo', '/upload/cairo.jpg', 'image/jpeg', 1472000, 'ì¹´ì´ë¡œ', 30.0444, 31.2357),
  
  -- ğŸ‡¿ğŸ‡¦ ë‚¨ì•„ê³µ - ì¼€ì´í”„íƒ€ìš´ (1ê°œ)
  (@planetId, 'photo', '/upload/capetown.jpg', 'image/jpeg', 1728000, 'ì¼€ì´í”„íƒ€ìš´', -33.9249, 18.4241);


-- 5. ì‚½ì…ëœ ë°ì´í„° í™•ì¸
SELECT '=== ì‚½ì…ëœ Stars ===' AS 'Info';
SELECT * FROM stars WHERE userId = @userId;

SELECT '=== ì‚½ì…ëœ Planets ===' AS 'Info';
SELECT * FROM planets WHERE starId = @starId;

SELECT '=== ì‚½ì…ëœ Planet Media ===' AS 'Info';
SELECT id, planetId, mediaType, location, latitude, longitude FROM planet_media WHERE planetId = @planetId;

-- 6. ì§€ë„ìš© ë°ì´í„° í™•ì¸ (GetMapLocationsServletì´ ë°˜í™˜í•  ë°ì´í„°)
SELECT '=== ì§€ë„ì— í‘œì‹œë  ë°ì´í„° ===' AS 'Info';
SELECT 
    pm.location AS 'ìœ„ì¹˜',
    pm.latitude AS 'ìœ„ë„',
    pm.longitude AS 'ê²½ë„',
    COUNT(*) AS 'ë¯¸ë””ì–´ ê°œìˆ˜'
FROM planet_media pm
INNER JOIN planets p ON pm.planetId = p.id
WHERE p.isDeleted = 0 
  AND pm.latitude IS NOT NULL 
  AND pm.longitude IS NOT NULL
  AND p.starId IN (SELECT id FROM stars WHERE userId = @userId)
GROUP BY pm.location, pm.latitude, pm.longitude
ORDER BY COUNT(*) DESC;

-- ì˜ˆìƒ ì§€ë„ í‘œì‹œ ê²°ê³¼:
-- +--------+----------+-----------+--------------+
-- | ìœ„ì¹˜   | ìœ„ë„     | ê²½ë„      | ë¯¸ë””ì–´ ê°œìˆ˜  |
-- +--------+----------+-----------+--------------+
-- | ì„œìš¸   | 37.5665  | 126.9780  | 3            |
-- | ë¶€ì‚°   | 35.1796  | 129.0756  | 2            |
-- | ì œì£¼ë„ | 33.4996  | 126.5312  | 2            |
-- | ê°•ë¦‰   | 37.7519  | 128.8761  | 1            |
-- | ê²½ì£¼   | 35.8562  | 129.2247  | 1            |
-- | ì „ì£¼   | 35.8242  | 127.1479  | 1            |
-- +--------+----------+-----------+--------------+